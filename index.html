<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=360, height=640, initial-scale=1, user-scalable=no">
<title></title>

<style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
body {
  margin: 0;
  background: #eaeaea;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
#etm {
  width: 360px;
  height: 640px;
  background: white;
  display: flex;
  flex-direction: column;
  border: 3px solid black;
}
.screen {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}
.hidden { display: none; }

.btn {
  background: #0078d7;
  color: white;
  border: none;
  padding: 14px;
  margin: 6px 0;
  font-size: 16px;
  width: 100%;
}
.btn:active { background: #005fa3; }

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin: 6px 0;
}

.status {
  height: 36px;
  background: black;
  color: white;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 8px;
}
</style>
</head>

<body>
<div id="etm">

<!-- LOGIN -->
<div id="login" class="screen">
  <h3>Driver Login</h3>
  <input id="loginUser" placeholder="Username">
  <input id="loginPin" placeholder="6-digit PIN" type="password">
  <button class="btn" onclick="login()">Log in</button>
  <button class="btn" onclick="showCreate()">Create account</button>
</div>

<!-- CREATE ACCOUNT -->
<div id="create" class="screen hidden">
  <h3>Create Account</h3>
  <input id="newEmail" placeholder="Email">
  <input id="newUser" placeholder="Username">
  <input id="newPin" placeholder="6-digit PIN" type="password">
  <button class="btn" onclick="createAccount()">Create</button>
  <button class="btn" onclick="backLogin()">Back</button>
</div>

<!-- MAIN MENU -->
<div id="menu" class="screen hidden">
  <button class="btn" onclick="showRoutes()">Routes</button>
  <button class="btn" onclick="showFleet()">Fleet</button>
  <button class="btn" onclick="showBoards()">Running Boards</button>
  <button class="btn" onclick="startTrip()">Start Trip</button>
  <button class="btn" onclick="logout()">Log out</button>
</div>

<!-- ROUTES -->
<div id="routes" class="screen hidden">
  <h3>Routes</h3>
  <input id="routeName" placeholder="Route name">
  <button class="btn" onclick="addRoute()">Add route</button>
  <div id="routeList"></div>
  <button class="btn" onclick="backMenu()">Back</button>
</div>

<!-- FLEET -->
<div id="fleet" class="screen hidden">
  <h3>Fleet</h3>
  <input id="veh" placeholder="Vehicle / fleet number">
  <button class="btn" onclick="addVehicle()">Add vehicle</button>
  <div id="fleetList"></div>
  <button class="btn" onclick="backMenu()">Back</button>
</div>

<!-- BOARDS -->
<div id="boards" class="screen hidden">
  <h3>Running Boards</h3>
  <input id="board" placeholder="Board name">
  <button class="btn" onclick="addBoard()">Add board</button>
  <div id="boardList"></div>
  <button class="btn" onclick="backMenu()">Back</button>
</div>

<!-- TRIP -->
<div id="trip" class="screen hidden">
  <h3>Trip Active</h3>
  <button class="btn" onclick="sell('Cash')">Cash Ticket</button>
  <button class="btn" onclick="sell('Card')">Card Ticket</button>
  <button class="btn" onclick="endTrip()">End Trip</button>
</div>

<!-- STATUS BAR -->
<div class="status">
  <span>WiFi ●●●</span>
  <span>Paper ███</span>
  <span id="clock"></span>
</div>

</div>

<script>
let currentUser = null;

function getData() {
  return JSON.parse(localStorage.getItem("etmUsers") || "{}");
}
function saveData(d) {
  localStorage.setItem("etmUsers", JSON.stringify(d));
}

function login() {
  const u = loginUser.value;
  const p = loginPin.value;
  const d = getData();
  if (d[u] && d[u].pin === p) {
    currentUser = u;
    show("menu");
  } else alert("Invalid login");
}

function createAccount() {
  const d = getData();
  const u = newUser.value;
  if (d[u]) return alert("User exists");
  d[u] = { email: newEmail.value, pin: newPin.value, routes: [], fleet: [], boards: [] };
  saveData(d);
  alert("Account created");
  backLogin();
}

function logout() { currentUser=null; show("login"); }

function addRoute() {
  const d = getData(); d[currentUser].routes.push(routeName.value); saveData(d); render();
}
function addVehicle() {
  const d = getData(); d[currentUser].fleet.push(veh.value); saveData(d); render();
}
function addBoard() {
  const d = getData(); d[currentUser].boards.push(board.value); saveData(d); render();
}

function startTrip() { show("trip"); }
function endTrip() { show("menu"); }
function sell(t){ alert(t+" ticket issued"); }

function render() {
  const d=getData()[currentUser];
  routeList.innerHTML=d.routes.join("<br>");
  fleetList.innerHTML=d.fleet.join("<br>");
  boardList.innerHTML=d.boards.join("<br>");
}

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  if(currentUser) render();
}
function showRoutes(){show("routes")}
function showFleet(){show("fleet")}
function showBoards(){show("boards")}
function backMenu(){show("menu")}
function showCreate(){show("create")}
function backLogin(){show("login")}

setInterval(()=>{
  const d=new Date();
  clock.textContent=d.toLocaleTimeString()+" "+d.toLocaleDateString();
},1000);
</script>
</body>
</html>
