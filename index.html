<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  background:#f0f0f0;
}
.machine {
  width:400px;
  height:90vh;
  background:#fff;
  border-radius:12px;
  box-shadow:0 8px 30px rgba(0,0,0,.4);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
/* Top banner */
.header {
  background:#000;
  color:#fff;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 12px;
}
.header .logo {font-size:18px; font-weight:900;}
.header .status {font-size:12px; display:flex; gap:10px;}
.header .status span {display:flex; align-items:center; gap:4px}

/* Screen */
.screen {
  flex:1;
  background:#fff;
  color:#000;
  padding:12px;
  font-family:monospace;
  overflow:auto;
  white-space:pre-line;
  font-size:16px;
  border-bottom:1px solid #ccc;
}

/* Buttons */
.buttons {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  padding:10px;
  background:#f0f0f0;
}
button {
  padding:18px 0;
  font-size:16px;
  font-weight:700;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button.blue{background:#0076c8; color:#fff;}
button.green{background:#27ae60; color:#fff;}
button.red{background:#c0392b; color:#fff;}
button.admin{background:#8e44ad; color:#fff;}
button.gray{background:#ccc; color:#000;}

/* Bottom banner */
.bottom-bar {
  background:#000;
  color:#fff;
  font-size:14px;
  padding:4px 12px;
  display:flex;
  justify-content:flex-end;
  align-items:center;
}
</style>
</head>
<body>

<div class="machine">
  <div class="header">
    <div class="logo">TICKETER</div>
    <div class="status">
      <span id="paper">Paper: ‚úîÔ∏è</span>
      <span id="wifi">WiFi: üì∂</span>
    </div>
  </div>

  <div class="screen" id="screen">ENTER 6-DIGIT DRIVER CODE</div>

  <!-- LOGIN KEYPAD -->
  <div class="buttons" id="loginPad">
    <button onclick="num(1)">1</button>
    <button onclick="num(2)">2</button>
    <button onclick="num(3)">3</button>
    <button onclick="num(4)">4</button>
    <button onclick="num(5)">5</button>
    <button onclick="num(6)">6</button>
    <button onclick="num(7)">7</button>
    <button onclick="num(8)">8</button>
    <button onclick="num(9)">9</button>
    <button class="red" onclick="clearPin()">CLR</button>
    <button onclick="num(0)">0</button>
    <button class="blue" onclick="login()">ENT</button>
  </div>

  <!-- MAIN CONTROLS -->
  <div class="buttons hidden" id="mainPad">
    <button class="green" onclick="startTrip()">START TRIP</button>
    <button class="red" onclick="endTrip()">END TRIP</button>
    <button class="blue" onclick="selectRoute()">ROUTE</button>
    <button class="blue" onclick="sell('cash')">CASH</button>
    <button class="blue" onclick="sell('card')">CARD</button>
    <button class="gray" onclick="showMessages()">MESSAGES</button>
    <button class="gray" onclick="logout()">LOG OUT</button>

    <button class="admin hidden" id="adminView" onclick="adminSwitch()">VIEW DRIVER</button>
    <button class="admin hidden" id="adminReturn" onclick="adminReturn()">RETURN ADMIN</button>
    <button class="admin hidden" id="adminMsg" onclick="adminMessage()">MESSAGE DRIVER</button>
    <button class="admin hidden" id="adminSetup" onclick="setupMenu()">SETUP ROUTES</button>
  </div>

  <div class="bottom-bar" id="bottomBar"></div>
</div>

<script>
const adminCode="889448";
let users={};
let enteredPin="";
let loggedInCode=null;
let viewingCode=null;
let adminActive=false;
let tripActive=false;
let currentRoute=null;

const screen=document.getElementById("screen");
const bottomBar=document.getElementById("bottomBar");

// LOGIN
function num(n){if(enteredPin.length<6){enteredPin+=n;screen.textContent="CODE: "+enteredPin;}}
function clearPin(){enteredPin="";screen.textContent="ENTER 6-DIGIT DRIVER CODE";}
function login(){
  if(enteredPin.length!==6) return;
  if(!users[enteredPin]){users[enteredPin]={code:enteredPin,routes:{},totals:{cash:0,card:0},messages:[]};}
  loggedInCode=enteredPin;
  viewingCode=enteredPin;
  adminActive=(enteredPin===adminCode);
  enteredPin="";
  document.getElementById("loginPad").classList.add("hidden");
  document.getElementById("mainPad").classList.remove("hidden");
  if(adminActive){
    document.getElementById("adminView").classList.remove("hidden");
    document.getElementById("adminReturn").classList.remove("hidden");
    document.getElementById("adminMsg").classList.remove("hidden");
    document.getElementById("adminSetup").classList.remove("hidden");
  }
  showDashboard();
}

// DASHBOARD
function showDashboard(){
  let u=users[viewingCode];
  screen.textContent=
`DRIVER: ${viewingCode}${adminActive && viewingCode!==loggedInCode ? "\nADMIN VIEW" : ""}
TRIP: ${tripActive?"ACTIVE":"STOPPED"}
ROUTE: ${currentRoute?currentRoute+" ("+u.routes[currentRoute].direction+")":"NONE"}

CASH: ¬£${u.totals.cash.toFixed(2)}
CARD: ¬£${u.totals.card.toFixed(2)}
MESSAGES: ${u.messages.length}`;
}

// TRIPS
function startTrip(){tripActive=true;showDashboard();}
function endTrip(){tripActive=false;currentRoute=null;showDashboard();}

// ROUTES
function selectRoute(){
  let u=users[viewingCode];
  let r=prompt("Enter Route Code:");
  if(!u.routes[r]){alert("ROUTE NOT FOUND");return;}
  let dir=prompt("Inbound or Outbound? (IN/OUT)","IN");
  u.routes[r].direction=dir.toUpperCase();
  currentRoute=r;
  showDashboard();
}

// TICKET SALES
function sell(type){
  if(!tripActive){alert("START TRIP FIRST");return;}
  if(!currentRoute){alert("SELECT ROUTE FIRST");return;}
  let u=users[viewingCode];
  let fare=u.routes[currentRoute].fare || 2;
  if(type==="cash") u.totals.cash+=fare;
  if(type==="card") u.totals.card+=fare;
  showDashboard();
}

// LOGOUT
function logout(){location.reload();}

// ADMIN
function adminSwitch(){
  if(!adminActive)return;
  let code=prompt("ENTER DRIVER CODE");
  if(!users[code]){alert("NOT FOUND");return;}
  viewingCode=code;
  showDashboard();
}
function adminReturn(){viewingCode=loggedInCode;showDashboard();}
function adminMessage(){
  if(!adminActive)return;
  let code=prompt("SEND TO DRIVER CODE");
  if(!users[code]){alert("NOT FOUND");return;}
  let msg=prompt("MESSAGE");
  users[code].messages.push(msg);
  alert("SENT");
}

// MESSAGES
function showMessages(){
  let msgs=users[viewingCode].messages;
  if(msgs.length===0){screen.textContent="NO MESSAGES";return;}
  screen.textContent="MESSAGES:\n\n"+msgs.map((m,i)=>`${i+1}. ${m}`).join("\n");
}

// ROUTE SETUP
function setupMenu(){
  if(!adminActive)return;
  let action=prompt("1=ADD ROUTE, 2=EDIT ROUTE, 3=DELETE ROUTE");
  if(action==="1") addRoute();
  if(action==="2") editRoute();
  if(action==="3") deleteRoute();
}
function addRoute(){
  let code=prompt("Route Code:");
  let dest=prompt("Destination:");
  let fare=parseFloat(prompt("Fare (¬£):","2"));
  users[loggedInCode].routes[code]={dest:dest,fare:fare,direction:"IN"};
  alert("ROUTE ADDED");
}
function editRoute(){
  let code=prompt("Route Code:");
  let r=users[loggedInCode].routes[code];
  if(!r){alert("NOT FOUND");return;}
  r.dest=prompt("Destination:",r.dest);
  r.fare=parseFloat(prompt("Fare (¬£):",r.fare));
  alert("UPDATED");
}
function deleteRoute(){
  let code=prompt("Route Code:");
  if(!users[loggedInCode].routes[code]){alert("NOT FOUND");return;}
  delete users[loggedInCode].routes[code];
  alert("DELETED");
}

// DATE & TIME
function updateTime(){
  let now=new Date();
  bottomBar.textContent=now.toLocaleString('en-GB',{hour12:false});
}
setInterval(updateTime,1000);
updateTime();
</script>

</body>
</html>
