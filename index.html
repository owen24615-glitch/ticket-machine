<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<title>Ticket Machine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
body{
  background:#d9dde3;
  font-family:"Segoe UI", Arial, Helvetica, sans-serif;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:20px;
  min-height:100vh;
  margin:0;
}

.machine{
  background:#f2f4f7;
  width:90%;
  max-width:400px;
  border-radius:10px;
  padding:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.25);
}

.header{
  background:#0076c8;
  color:white;
  padding:10px;
  border-radius:6px;
  font-weight:600;
  text-align:center;
  margin-bottom:8px;
}

.screen{
  background:#ffffff;
  color:#000;
  font-family:"Segoe UI", Arial, sans-serif;
  padding:12px;
  min-height:140px;
  border-radius:6px;
  margin-bottom:10px;
  white-space:pre-line;
  border:2px solid #cfd6df;
}

.buttons{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}

button{
  padding:14px 0;
  font-size:16px;
  border:none;
  border-radius:4px;
  background:#e3e7ec;
  color:#000;
  cursor:pointer;
  font-weight:600;
}

button:hover{background:#d6dbe2;}
.enter{ background:#0076c8; color:#fff; }
.enter:hover{ background:#005fa3; }
.cancel{ background:#d92d20; color:#fff; }
.cancel:hover{ background:#b42318; }
.pay{ background:#0e9384; color:#fff; }
.pay:hover{ background:#107569; }
.print{ background:#344054; color:#fff; }
.print:hover{ background:#1f2937; }
.setup{ background:#f79009; color:#000; }
.totals{ background:#475467; color:#fff; }
.trip{ background:#16a34a; color:#fff; }
.trip:hover{ background:#15803d; }
.full{ width:100%; margin-top:6px; font-size:16px; }

/* Portrait adjustments */
@media (orientation: portrait) {
  .machine { width:95%; max-width:360px; }
  button { font-size:18px; padding:16px 0; }
  .screen { min-height:160px; }
}
</style>
</head>

<body>

<div class="machine">
  <div class="header">TICKETING SYSTEM</div>
  <div class="screen" id="screen">ENTER DRIVER PIN</div>

  <div class="buttons" id="keypad">
    <button onclick="pressKey('1')">1</button>
    <button onclick="pressKey('2')">2</button>
    <button onclick="pressKey('3')">3</button>
    <button onclick="pressKey('4')">4</button>
    <button onclick="pressKey('5')">5</button>
    <button onclick="pressKey('6')">6</button>
    <button onclick="pressKey('7')">7</button>
    <button onclick="pressKey('8')">8</button>
    <button onclick="pressKey('9')">9</button>
    <button class="cancel" onclick="clearInput()">CLR</button>
    <button onclick="pressKey('0')">0</button>
    <button class="enter" onclick="enter()">ENT</button>
  </div>

  <div class="buttons" id="sell" style="display:none;">
    <button onclick="selectTicket('adult')">Adult</button>
    <button onclick="selectTicket('child')">Child</button>
    <button onclick="selectTicket('day')">Day</button>
    <button class="pay" onclick="pay('Card')">Card</button>
    <button class="pay" onclick="pay('Cash')">Cash</button>
    <button class="cancel" onclick="resetSale()">Cancel</button>
  </div>

  <button class="trip full" id="startTripBtn" onclick="startTrip()" style="display:none;">START TRIP</button>
  <button class="trip full" id="endTripBtn" onclick="endTrip()" style="display:none;">END TRIP</button>

  <button class="print full" id="printBtn" style="display:none;" onclick="printTicket()">PRINT TICKET</button>
  <button class="setup full" onclick="setupMenu()">SETUP</button>
  <button class="totals full" onclick="showTotals()">TOTALS</button>
</div>

<script>
const DRIVER_PIN="1234";
const SETUP_PIN="9999";

let routes=JSON.parse(localStorage.getItem("routes"))||{};
let totals={tickets:0,cash:0,card:0,revenue:0};

let input="", stage="login", currentRoute="", currentFare=0, currentFarePaidMethod="", tripActive=false, direction="outbound";

function updateScreen(t){document.getElementById("screen").textContent=t;}
function pressKey(n){input+=n;updateScreen("*".repeat(input.length));}
function clearInput(){input="";updateScreen(stage==="login"?"ENTER DRIVER PIN":"ENTER ROUTE");}

function enter(){
  if(stage==="login"){
    if(input===DRIVER_PIN){stage="route";input="";updateScreen("ENTER ROUTE");}
    else{input="";updateScreen("INVALID PIN");}
    return;
  }
  if(stage==="route"){
    if(!routes[input]){input="";updateScreen("ROUTE NOT FOUND");return;}
    currentRoute=input;
    stage="routeSelected";
    input="";
    document.getElementById("keypad").style.display="none";
    document.getElementById("startTripBtn").style.display="block";

    // Choose direction
    let dir = prompt("Select direction:\n1 = Outbound\n2 = Inbound","1");
    direction = (dir==="2")?"inbound":"outbound";
    updateScreen("ROUTE "+currentRoute+"\n"+routes[currentRoute][direction]+"\nPRESS START TRIP");
  }
}

function startTrip(){
  tripActive=true;
  document.getElementById("sell").style.display="grid";
  document.getElementById("startTripBtn").style.display="none";
  document.getElementById("endTripBtn").style.display="block";
  updateScreen("TRIP STARTED\nROUTE "+currentRoute+"\n"+routes[currentRoute][direction]);
}

function endTrip(){
  tripActive=false;
  currentRoute=""; stage="route";
  document.getElementById("sell").style.display="none";
  document.getElementById("endTripBtn").style.display="none";
  document.getElementById("keypad").style.display="grid";
  updateScreen("TRIP ENDED\nENTER ROUTE");
}

function selectTicket(type){
  if(!tripActive){updateScreen("START TRIP FIRST");return;}
  currentFare=routes[currentRoute][type+"_"+direction]||0;
  updateScreen(type.toUpperCase()+"  £"+currentFare.toFixed(2));
}

function pay(method){
  if(!tripActive){updateScreen("START TRIP FIRST"); return;}
  currentFarePaidMethod = method; 
  updateScreen("PAYMENT\n"+method+"\nAPPROVED\nPRESS PRINT");
  document.getElementById("printBtn").style.display="block";
}

function printTicket(){
  totals.tickets++;
  totals.revenue += currentFare;
  if(currentFarePaidMethod === "Cash") totals.cash += currentFare;
  else totals.card += currentFare;

  updateScreen("PRINTING...\nTHANK YOU");
  
  currentFare = 0;
  currentFarePaidMethod = "";
  document.getElementById("printBtn").style.display="none";
  updateScreen("TRIP ACTIVE\nROUTE "+currentRoute+"\n"+routes[currentRoute][direction]);
}

function resetSale(){
  currentFare=0; currentFarePaidMethod="";
  document.getElementById("printBtn").style.display="none";
  if(tripActive) updateScreen("TRIP ACTIVE\nROUTE "+currentRoute+"\n"+routes[currentRoute][direction]);
}

function setupMenu(){
  if(prompt("SETUP PIN")!==SETUP_PIN)return alert("DENIED");
  const a=prompt("1=ADD\n2=EDIT\n3=DELETE");
  if(a==="1") addRoute();
  if(a==="2") editRoute();
  if(a==="3") deleteRoute();
}

function addRoute(){
  const r=prompt("Route number:");
  routes[r]={
    outbound:prompt("Outbound destination:"),
    inbound:prompt("Inbound destination:"),
    adult_outbound:+prompt("Adult fare outbound:"),
    child_outbound:+prompt("Child fare outbound:"),
    day_outbound:+prompt("Day fare outbound:"),
    adult_inbound:+prompt("Adult fare inbound:"),
    child_inbound:+prompt("Child fare inbound:"),
    day_inbound:+prompt("Day fare inbound:")
  };
  localStorage.setItem("routes",JSON.stringify(routes));
}

function editRoute(){
  const r=prompt("Route number to edit:");
  if(!routes[r])return alert("Not found");
  routes[r].outbound=prompt("Outbound destination:",routes[r].outbound);
  routes[r].inbound=prompt("Inbound destination:",routes[r].inbound);
  routes[r].adult_outbound=+prompt("Adult fare outbound:",routes[r].adult_outbound);
  routes[r].child_outbound=+prompt("Child fare outbound:",routes[r].child_outbound);
  routes[r].day_outbound=+prompt("Day fare outbound:",routes[r].day_outbound);
  routes[r].adult_inbound=+prompt("Adult fare inbound:",routes[r].adult_inbound);
  routes[r].child_inbound=+prompt("Child fare inbound:",routes[r].child_inbound);
  routes[r].day_inbound=+prompt("Day fare inbound:",routes[r].day_inbound);
  localStorage.setItem("routes",JSON.stringify(routes));
}

function deleteRoute(){
  const r=prompt("Route number to delete:");
  if(!routes[r])return alert("Not found");
  delete routes[r];
  localStorage.setItem("routes",JSON.stringify(routes));
}

function showTotals(){
  updateScreen(
`END OF SHIFT
--------------
Tickets: ${totals.tickets}
Cash: £${totals.cash.toFixed(2)}
Card: £${totals.card.toFixed(2)}
--------------
TOTAL: £${totals.revenue.toFixed(2)}`
  );
}
</script>
</body>
</html>
