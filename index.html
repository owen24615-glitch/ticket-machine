<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ticket Machine</title>

<style>
body{
  margin:0;
  background:#1e2228;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.machine{
  width:380px;
  height:90vh;
  background:#2b2f36;
  border-radius:18px;
  box-shadow:0 10px 40px rgba(0,0,0,.6);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.header{
  background:#0b0d11;
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:700;
  letter-spacing:1px;
}

.screen{
  flex:1;
  background:#111;
  color:#00ff9c;
  padding:12px;
  font-family:monospace;
  overflow:auto;
  white-space:pre-line;
}

.buttons{
  background:#1a1d23;
  padding:10px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

button{
  padding:14px;
  font-size:14px;
  font-weight:700;
  border:none;
  border-radius:10px;
  background:#3a3f48;
  color:#fff;
}

button.primary{background:#00aaff;}
button.danger{background:#c0392b;}
button.admin{background:#8e44ad;}
button.green{background:#27ae60;}

.hidden{display:none;}
</style>
</head>

<body>

<div class="machine">
  <div class="header">TICKETER</div>
  <div class="screen" id="screen">ENTER DRIVER PIN</div>

  <div class="buttons" id="loginPad">
    <button onclick="num(1)">1</button><button onclick="num(2)">2</button>
    <button onclick="num(3)">3</button><button onclick="num(4)">4</button>
    <button onclick="num(5)">5</button><button onclick="num(6)">6</button>
    <button onclick="num(7)">7</button><button onclick="num(8)">8</button>
    <button onclick="num(9)">9</button><button onclick="num(0)">0</button>
    <button onclick="clearPin()">CLEAR</button>
    <button class="primary" onclick="login()">ENTER</button>
  </div>

  <div class="buttons hidden" id="mainPad">
    <button class="green" onclick="startTrip()">START TRIP</button>
    <button class="danger" onclick="endTrip()">END TRIP</button>
    <button onclick="sell('cash')">CASH £2</button>
    <button onclick="sell('card')">CARD £2</button>
    <button onclick="showMessages()">MESSAGES</button>
    <button onclick="logout()">LOG OUT</button>

    <button class="admin hidden" id="adminView" onclick="adminSwitch()">VIEW DRIVER</button>
    <button class="admin hidden" id="adminReturn" onclick="adminReturn()">RETURN ADMIN</button>
    <button class="admin hidden" id="adminMsg" onclick="adminMessage()">MESSAGE DRIVER</button>
  </div>
</div>

<script>
const adminCode = "889448";

let users = {};
let enteredPin = "";
let loggedInCode = null;
let viewingCode = null;
let adminActive = false;
let tripActive = false;

const screen = document.getElementById("screen");

function num(n){
  if(enteredPin.length<6){
    enteredPin+=n;
    screen.textContent="PIN: "+enteredPin;
  }
}

function clearPin(){
  enteredPin="";
  screen.textContent="ENTER DRIVER PIN";
}

function login(){
  if(enteredPin.length!==6)return;

  if(!users[enteredPin]){
    users[enteredPin]={
      code:enteredPin,
      cash:0,
      card:0,
      messages:[]
    };
  }

  loggedInCode = enteredPin;
  viewingCode = enteredPin;
  adminActive = (enteredPin===adminCode);
  enteredPin="";

  document.getElementById("loginPad").classList.add("hidden");
  document.getElementById("mainPad").classList.remove("hidden");

  if(adminActive){
    document.getElementById("adminView").classList.remove("hidden");
    document.getElementById("adminMsg").classList.remove("hidden");
  }

  showDashboard();
}

function showDashboard(){
  let u = users[viewingCode];
  screen.textContent =
`DRIVER: ${viewingCode}
${adminActive && viewingCode!==loggedInCode ? "ADMIN VIEW\n" : ""}
TRIP: ${tripActive?"ACTIVE":"STOPPED"}

CASH: £${u.cash}
CARD: £${u.card}

MESSAGES: ${u.messages.length}`;
}

function startTrip(){
  tripActive=true;
  showDashboard();
}

function endTrip(){
  tripActive=false;
  showDashboard();
}

function sell(type){
  if(!tripActive)return alert("START TRIP FIRST");
  users[viewingCode][type]+=2;
  showDashboard();
}

function logout(){
  location.reload();
}

/* ADMIN FEATURES */

function adminSwitch(){
  let code = prompt("ENTER DRIVER CODE");
  if(!users[code]) return alert("NOT FOUND");
  viewingCode = code;
  document.getElementById("adminReturn").classList.remove("hidden");
  showDashboard();
}

function adminReturn(){
  viewingCode = loggedInCode;
  document.getElementById("adminReturn").classList.add("hidden");
  showDashboard();
}

function adminMessage(){
  let code = prompt("SEND TO DRIVER CODE");
  if(!users[code]) return alert("NOT FOUND");
  let msg = prompt("MESSAGE");
  users[code].messages.push(msg);
  alert("SENT");
}

/* DRIVER MESSAGES */

function showMessages(){
  let msgs = users[viewingCode].messages;
  if(msgs.length===0){
    screen.textContent="NO MESSAGES";
    return;
  }
  screen.textContent="MESSAGES:\n\n"+msgs.map((m,i)=>`${i+1}. ${m}`).join("\n");
}
</script>

</body>
</html>
